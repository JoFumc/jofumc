<?php
// PHP service script to emit profile editor form

  // This is an HTML-formatted service
header('Content-type: text/html');
?>
<?php
/* Step 1: Includes */
require_once("library/core/class-book.php");
require_once("library/core/class-story.php");
require_once("library/core/class-form.php");
require_once("library/core/util-auth.php");

/* Step 2: Get user auth info */
auth_validate();

/* Step 3: Service story */
$ss = new akStory("edit-profile-story");
$ss->createSimpleChunk(STORY_CHUNK_SECTION,"Editing Book: Profile Settings");
$ss->emit();

/* Step 2: Start form */
  /* NOTE: This is a service-based form, so won't actually
   *       get posted anywhere...the onClick handler of the
   *       "submit" button will reload the service.
   */
$pf = new akForm("edit-profile-form");

$pf->createSimpleItem("profile-display-name", FORM_ITEM_TEXT,
                      "profile-display-name", $auth_user->displayname,
                      "Display Name:");

$pf->createSimpleItem("profile-full-name", FORM_ITEM_TEXT,
                      "profile-full-name", $auth_user->fullname,
                      "Full Name:");

$pf->createSimpleItem("profile-email", FORM_ITEM_TEXT,
                      "profile-email", $auth_user->email,
                      "Email:");

$pf->createSimpleItem("profile-password", FORM_ITEM_PASSWORD,
                      "profile-password", null, "New Password:");
$pf->createSimpleItem("profile-password-confirm", FORM_ITEM_PASSWORD,
                      "profile-password-confirm", null, "Confirm Password:");

$pf->createSimpleItem("profile-skin-frame",FORM_ITEM_RAW,
                      "profile-skin-frame","Which theme would you like to use?");
$pf->createSimpleItem("profile-skin-agua",FORM_ITEM_RADIO,
                      "profile-skin",'agua',"Agua (light blue theme; wide and open layout)");
if ($auth_user->skin == 'agua') $pf->lastSimpleItem->hint = "checked";
$pf->createSimpleItem("profile-skin-wine",FORM_ITEM_RADIO,
                      "profile-skin",'wine',"Wine (wine-colored theme; sidebar and box layout)");
if ($auth_user->skin == 'wine') $pf->lastSimpleItem->hint = "checked";
$pf->createSimpleItem("profile-skin-basic",FORM_ITEM_RADIO,
                      "profile-skin",'basic',"Basic (red and white theme; compact, enclosed layout");
if ($auth_user->skin == 'basic') $pf->lastSimpleItem->hint = "checked";

$pf->createSimpleItem("profile-update", FORM_ITEM_BUTTON,
                      "profile-update", "Update");

$pf->lastSimpleItem->addEvent('onClick',"if (document.getElementById('profile-password').value == document.getElementById('profile-password-confirm').value) { svc_loadDiv('bookshelf-canvas-container','process-book-profile',svc_formParameters('edit-profile-form')); } else { alert('Password mismatch.'); }; return false;");

$pf->emit();


?>
